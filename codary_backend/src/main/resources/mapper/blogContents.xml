<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.web.dao.BlogContentsDao">

	<select id="getContent" parameterType="int" resultType="BlogContentsDto">
		select *
		from blogcontents
		where blog_contents_id = #{blogContentsId}
	</select>
	
	<insert id="writeBlogContent" parameterType="BlogContentsDto">
		insert into blogcontents(blog_contents_id, blog_id, blog_contents_title, blog_contents, blog_contents_view, blog_contents_like, blog_datetime, blog_contents_cover)
		values (#{blogContentsId}, #{blogId}, #{blogContentsTitle}, #{blogContents}, 0, 0, now(), #{blogContentsCover});
	</insert>
	
	<select id="listBlogContents" parameterType="String" resultType="BlogContentsDto">
		select *
		from blogcontents
		where blog_id = #{blogId}
	</select>
	
 	<update id="modifyBlogContent" parameterType="BlogContentsDto">
		update blogcontents
		set blog_contents = #{blogContents}, blog_contents_title = #{blogContentsTitle}, blog_contents_cover = #{blogContentsCover}
		where blog_id = #{blogId} and blog_contents_id = #{blogContentsId}
	</update>
	
	<delete id="deleteBlogContent" parameterType="int">
		delete from blogcontents
		where blog_contents_id = #{blogContentsId}
	</delete>
	
	<select id="getAllContents" resultType="BlogContentsDto">
		select *
		from blogcontents
	</select>
	
	<insert id="writeLog" parameterType="map">
		insert into log
		values(now(),#{uid},#{blogContentsId});
	</insert>
	
	<update id="increaseContentsView" parameterType="int">
		update blogcontents
		set blog_contents_view = blog_contents_view + 1
		where blog_contents_id = #{blogContentsId}
	</update>
	
	<select id="readContentLike" resultType="BlogContentsLikeDto">
		select *
		from blogcontentslike
		where uid = #{uid} and blog_contents_id=#{blog_contents_id}
	</select>
	
	<insert id="createContentLike">
		insert into blogcontentslike(uid, blog_contents_id)
		values(#{uid}, #{blog_contents_id})
	</insert>
	
	<delete id="deleteContentLike">
		delete from blogContentslike
		where uid = #{uid} and blog_contents_id=#{blog_contents_id}
	</delete>
	
	<insert id="usergraphViewCount" parameterType="int">
		insert into usergraph (blog_id, usergraph_date, blog_view) 
		select blog_id, now(), 0 from blogcontents where blog_contents_id=#{blogContentsId};
	</insert>
	
</mapper>